const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/CreateEditForm.js","js/vendor.js","css/vendor.css","js/FieldUsageTypes.js","js/index.js","css/index.css"])))=>i.map(i=>d[i]);
import{r as C,e as s,E as m,X as g,a7 as I,z as o,am as P,aa as _,x as n,a6 as M,an as K,ao as B,c,ap as H,aq as q,ar as j,L as v,O as S,as as N,at as W,K as f,au as U,av as z,aw as D,ax as G,ay as O,T as X,az as J,aA as E,aB as Y,aC as k,aD as Z,aE as V,aF as $,_ as ee}from"./vendor.js";import{D as te,R as x,a as A,C as L,b as ae,c as le,S as re,Q as w}from"./FieldUsageTypes.js";import{_ as R,H as F}from"./index.js";const ie={name:"OverviewTab",components:{DatapointForDisplayInner:te,RecordFieldsForDisplayCustom:x,RecordFieldsForDisplayGeneric:A},props:{templateOverview:{type:Object,default(){return{}}},filteredChildRelations:{type:Array,default(){return[]}},childRelations:{type:Array,default(){return[]}},item:{type:Object,default(){return{}}},superOptions:{type:Object,default(){return{headers:[],modelFields:[],displayMapField:!1,model:{},canEdit:!1,currentParentRecord:{}}}}},methods:{deleteItem(e){this.$emit("deleteItem",e)},editItem(e){this.$emit("editItem",e)},clickRow(e){this.$emit("clickRow",e)}}},se={key:0,class:"text-center q-pa-md text-grey-5"},ne={key:0,style:{"padding-top":"0.03px"}},de={class:"row q-col-gutter-xs"};function oe(e,t,l,d,r,a){const p=C("RecordFieldsForDisplayCustom"),u=C("RecordFieldsForDisplayGeneric");return s(),m("div",null,[!l.item||l.item.constructor===Object&&Object.keys(l.item).length===0?(s(),m("div",se,"None")):(s(),m(g,{key:1},[l.templateOverview&&l.templateOverview.cols?(s(),m("div",ne,[I("div",de,[o(p,{item:l.item,childRelations:l.childRelations,filteredChildRelations:l.filteredChildRelations,superOptions:l.superOptions,template:l.templateOverview,onEditItem:a.editItem,onDeleteItem:a.deleteItem},P({_:2},[_(e.$slots,(b,h)=>({name:h,fn:n(i=>[M(e.$slots,h,K(B(i)))])}))]),1032,["item","childRelations","filteredChildRelations","superOptions","template","onEditItem","onDeleteItem"])])])):(s(),c(u,{key:1,item:l.item,superOptions:l.superOptions,onEditItem:a.editItem,onDeleteItem:a.deleteItem},null,8,["item","superOptions","onEditItem","onDeleteItem"]))],64))])}const me=R(ie,[["render",oe],["__file","OverviewTab.vue"]]),ue={name:"CreateButtonWithDropDowns",components:{CrudModal:L},props:{parentKeyValuePair:{type:Function,default:()=>{}},childRelations:{type:Array,default:[]},canEdit:{type:Boolean,default:!0},createButtonText:{type:String,default:""},canCreateMsg:{type:String,default:""},canCreatePart2:{type:Boolean,default:!1}},data(){return{menu:!1}},computed:{modelTypes(){const e=[];for(const t of this.childRelations)t.canBeCalendared&&e.push({label:t.field.meta.field.related.entityHumanName,value:t.field.meta.field.related.entityHumanName,meta:t});return e}},methods:{emitCreateItem(e){this.menu=!1,this.$emit("create-item",e)}}};function ce(e,t,l,d,r,a){return s(),m("div",null,[o(N,{modelValue:r.menu,"onUpdate:modelValue":t[0]||(t[0]=p=>r.menu=p),disable:!l.canEdit,outline:"",class:"q-mb-md",label:l.createButtonText?l.createButtonText:"New"},{default:n(()=>[o(H,{style:{"min-width":"120px"}},{default:n(()=>[(s(!0),m(g,null,_(a.modelTypes,(p,u)=>(s(),c(q,{key:u,clickable:"",onClick:b=>a.emitCreateItem(u)},{default:n(()=>[o(j,null,{default:n(()=>[v(S(p.label),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue","disable","label"]),l.canCreateMsg.length?(s(),c(W,{key:0,bottom:"",disable:l.canCreatePart2},{default:n(()=>[I("span",null,S(l.canCreateMsg),1)]),_:1},8,["disable"])):f("",!0)])}const pe=R(ue,[["render",ce],["__file","CreateButtonWithDropDowns.vue"]]),fe={name:"CalendarPolyContentWrapper",components:{CrudModal:L,CreateButtonWithDropDowns:pe,SuperCalendar:ae},props:{configsCollection:{type:Object,default:{}},childRelations:{type:Array,required:!0},parentPrimaryKey:{type:[String,Number],default:null}},data(){return{loading:!0,loadingStatus:{},mergedData:[],configsFetched:!1,options:{page:1,itemsPerPage:10,sortBy:[],groupBy:[]},fetchedData:[]}},computed:{allLoaded(){return Object.values(this.loadingStatus).every(e=>e===!0)},mergedConfigs(){var t,l,d,r,a;const e=[];for(const p in this.childRelations){const u=this.childRelations[p];if(u.canBeCalendared){const b=F.getFieldFromModelOrParent(u.superOptions.headers,"timeRangeStart"),h=F.getFieldFromModelOrParent(u.superOptions.headers,"timeRangeEnd"),i=u.field.meta.field.related;e.push({startFieldName:b,endFieldName:h,items:((d=(l=(t=this.fetchedData[p])==null?void 0:t.response)==null?void 0:l.data)==null?void 0:d.data)||[],superOptions:u.superOptions,unClickable:((r=this.configsCollection[i.name])==null?void 0:r.clickRow)||(()=>{}),templateListCalendar:((a=this.configsCollection[i.name])==null?void 0:a.templateListCalendar)||{}})}}return e}},mounted(){this.fetchAllModels()},methods:{actionComplete(){this.$refs.SuperCalendar.viewItemData.showModal=!1},createItem(e){this.$refs[`CrudModalRef${e}`][0].createItem()},editItem(e,t){this.$refs[`CrudModalRef${t}`][0].editItem(e)},deleteItem(e,t){this.$refs[`CrudModalRef${t}`][0].deleteItem(e)},async fetchData(e,t){try{const l=await this.fetchItem(e);this.fetchedData[t]=l}catch(l){console.error("Error fetching data:",l)}finally{this.loading=!1}},fetchItem(e){var a;const t=e.field.meta.field.related;let l=[];(a=t.rules)!=null&&a.readables&&(l=t.rules.readables());const d={},r={sort:`-${t.primaryKey}`,per_page:this.options.itemsPerPage,page:this.options.page};return t.FetchAll([],{...l,...r},d,{page:this.options.page,limit:this.options.itemsPerPage,filters:this.filters(e),clearPrimaryModelOnly:!1})},filters(e){const t=this.parentKeyValuePair(e);return{[t.parentFKey]:t.parentFVal}},parentKeyValuePair(e){return{parentFKey:e.field.meta.field.foreignKey,parentFVal:this.parentPrimaryKey}},async fetchAllModels(){try{this.loading=!0;const e=this.childRelations.map(l=>this.fetchItem(l)),t=await Promise.all(e);this.fetchedData=t}catch(e){console.error("Error fetching data:",e)}finally{this.loading=!1}}}},he=e=>(U("data-v-cbfc7f39"),e=e(),z(),e),ye={key:0},Ce=he(()=>I("div",{class:"text-center q-pa-md"},"Loading...",-1)),ve=[Ce];function ge(e,t,l,d,r,a){const p=C("CreateButtonWithDropDowns"),u=C("SuperCalendar"),b=C("CrudModal");return s(),m("div",null,[r.loading?(s(),m("div",ye,ve)):(s(),m(g,{key:1},[o(p,{childRelations:l.childRelations,onCreateItem:a.createItem,fetchData:a.fetchData,parentKeyValuePair:a.parentKeyValuePair},null,8,["childRelations","onCreateItem","fetchData","parentKeyValuePair"]),o(u,{ref:"SuperCalendar",onEditItem:a.editItem,onDeleteItem:a.deleteItem,loading:r.loading,mixedConfigs:a.mergedConfigs},null,8,["onEditItem","onDeleteItem","loading","mixedConfigs"]),(s(!0),m(g,null,_(l.childRelations,(h,i)=>(s(),c(b,{onDeleteComplete:a.actionComplete,onEditComplete:a.actionComplete,onFetchData:y=>a.fetchData(h,i),ref_for:!0,ref:`CrudModalRef${i}`,superOptions:h.superOptions,parentKeyValuePair:a.parentKeyValuePair(h)},null,8,["onDeleteComplete","onEditComplete","onFetchData","superOptions","parentKeyValuePair"]))),256))],64))])}const be=R(fe,[["render",ge],["__scopeId","data-v-cbfc7f39"],["__file","CalendarPolyContentWrapper.vue"]]),we=$(()=>ee(()=>import("./CreateEditForm.js"),__vite__mapDeps([0,1,2,3,4,5]))),_e={name:"SuperRecord",components:{CalendarPolyContentWrapper:be,CreateEditForm:we,OverviewTab:me,SuperTableTable:le,RecordFieldsForDisplayCustom:x,RecordFieldsForDisplayGeneric:A,SuperTable:re},props:{configsCollection:{type:Object,default:{}},allowedTabs:{type:Array,default(){return[]}},templateOverview:{type:Object,default(){return{}}},templateForm:{type:Object,default(){return{}}},model:{type:[Object,Function],required:!0},id:{type:Number,required:!0},displayMapField:{type:Boolean,default:!1},relationships:{type:Array,default(){return[]}}},data(){return{deleteItemData:{showModal:!1,data:null},editItemData:{showModal:!1,data:null},activeTab:"tab-overview",loading:!0,initialLoadHappened:!1,item:{},formServerErrors:{}}},computed:{someChildrenCanBeCalendared(){return this.childRelations.some(e=>e.canBeCalendared)},someChildrenCanBeMapped(){return this.childRelations.some(e=>e.canBeMapped)},superOptions(){return{headers:this.headers,modelFields:this.modelFields,displayMapField:this.displayMapField,model:this.model,canEdit:this.canEdit}},fieldsUsedInOverview(){const e=[];if(this.templateOverview&&this.templateOverview.cols)for(const t of this.templateOverview.cols)if(t.cols)for(const l of t.cols)l.dataPoint.field&&e.push(l.dataPoint.field);else t.dataPoint.field&&e.push(t.dataPoint.field);return e},canEdit(){return!0},childRelations(){const e=w.computedAttrs(this.model,[]),t=[];for(let l in e){const d=e[l];if(d.usageType.startsWith("relChildren")){const r={field:d},a=w.SupaerTableHeaders(d.meta.field.related,[this.parentKeyValuePair({field:d}).parentFKey]);F.getFieldFromModelOrParent(a,"timeRangeStart")?r.canBeCalendared=!0:r.canBeCalendared=!1,F.getFieldFromModelOrParent(a,"mapExtraGeoLocLong")?r.canBeMapped=!0:r.canBeMapped=!1,r.superOptions={headers:a,modelFields:w.computedAttrs(d.meta.field.related,[this.parentKeyValuePair({field:d}).parentFKey]),displayMapField:!1,model:d.meta.field.related,canEdit:d.meta.field.related.rules.creatable()},t.push(r)}}return t},filteredChildRelations(){let e=[];this.allowedTabs;for(const t of this.childRelations)!this.fieldsUsedInOverview.includes(t.field.name)&&(this.allowedTabs.length===0||this.allowedTabs.includes(t.field.name))&&e.push(t);return e},headers(){return w.SupaerTableHeaders(this.model,[],this.canEdit,this.displayMapField)},modelFields(){return w.computedAttrs(this.model,[])}},methods:{clickRow(e,t,l){l.field.meta.field.related.openRecord(e,t,this.$router)},parentKeyValuePair(e){return{parentFKey:e.field.meta.field.foreignKey,parentFVal:this.item[this.model.primaryKey],parentItem:this.item}},deleteItem(e){this.$emit("deleteItem",e),this.deleteItemData.data=e,this.deleteItemData.showModal=!0},deleteItemSubmit(){this.superOptions.model.Delete(this.deleteItemData.data.id).then(()=>{this.fetchData()}),this.deleteItemData.showModal=!1},editItem(e){this.$emit("editItem",e),this.editItemData.data={...e},this.editItemData.showModal=!0},editItemSubmit(){const e=w.preparePayload(this.editItemData.data,this.superOptions.modelFields);this.superOptions.model.Update(e).then(()=>{this.fetchData(),this.editItemData.showModal=!1,this.formServerErrors={}}).catch(t=>{this.formServerErrors=t.response.data})},getMsg(e){return Array.isArray(e)?e.length>1?`To create first set your active ${e[0]} group and active ${e[1]} group`:"":`To create first set your active ${e} group`},filters(e){const t=this.parentKeyValuePair(e);return{[t.parentFKey]:t.parentFVal}},fetchData(){this.loading=!0,this.model.FetchById(this.id,this.relationships,{flags:{},moreHeaders:{},rels:[]}).then(e=>{this.item=e.response.data.data,this.loading=!1,this.initialLoadHappened=!0,this.$emit("initialLoadHappened",!0)}).catch(()=>{this.loading=!1,this.initialLoadHappened=!0,this.$emit("initialLoadHappened",!0)})}},mounted(){this.allowedTabs.length&&(this.activeTab=`tab-${this.allowedTabs[0]}`),this.fetchData()},watch:{activeTab(e){this.$nextTick(()=>{this.$refs[e]&&this.$refs[e][0].fetchData()})},item(e){Object.keys(e).length!==0&&this.$emit("update:item",e)}}},Ie={key:1,class:"text-center q-pa-md"},De=I("div",{class:"text-h6"},"Delete Item",-1),Oe=I("p",null,"Are you sure you want to delete this item?",-1);function Fe(e,t,l,d,r,a){const p=C("OverviewTab"),u=C("CalendarPolyContentWrapper"),b=C("SuperTable"),h=C("CreateEditForm");return s(),m("div",null,[I("div",null,[this.allowedTabs.length!==1?(s(),c(G,{key:0,modelValue:r.activeTab,"onUpdate:modelValue":t[0]||(t[0]=i=>r.activeTab=i),align:"left"},{default:n(()=>[this.allowedTabs.length===0||this.allowedTabs.includes("overview")?(s(),c(D,{key:0,name:"tab-overview","data-name":"overview"},{default:n(()=>[v(" Overview ")]),_:1})):f("",!0),a.someChildrenCanBeMapped&&(this.allowedTabs.length===0||this.allowedTabs.includes("map"))?(s(),c(D,{key:1,name:"tab-map","data-name":"map"},{default:n(()=>[v(" Map ")]),_:1})):f("",!0),a.someChildrenCanBeCalendared&&(this.allowedTabs.length===0||this.allowedTabs.includes("calendar"))?(s(),c(D,{key:2,name:"tab-calendar","data-name":"calendar"},{default:n(()=>[v(" Calendar ")]),_:1})):f("",!0),(s(!0),m(g,null,_(a.filteredChildRelations,(i,y)=>(s(),c(D,{key:y,name:"tab-"+y,"data-name":i.field.name},{default:n(()=>[v(S(i.field.label),1)]),_:2},1032,["name","data-name"]))),128))]),_:1},8,["modelValue"])):f("",!0),o(J,{modelValue:r.activeTab,"onUpdate:modelValue":t[1]||(t[1]=i=>r.activeTab=i),class:X(this.allowedTabs.length==1?"SuperRecorSingleTabOnly":"")},{default:n(()=>[this.allowedTabs.length===0||this.allowedTabs.includes("overview")?(s(),c(O,{key:0,name:"tab-overview"},{default:n(()=>[r.loading?(s(),m("div",Ie,"Loading...")):(s(),c(p,{key:0,item:r.item,superOptions:a.superOptions,templateOverview:l.templateOverview,filteredChildRelations:a.filteredChildRelations,childRelations:a.childRelations,onEditItem:a.editItem,onDeleteItem:a.deleteItem},P({_:2},[_(e.$slots,(i,y)=>({name:y,fn:n(T=>[M(e.$slots,y,K(B(T)))])}))]),1032,["item","superOptions","templateOverview","filteredChildRelations","childRelations","onEditItem","onDeleteItem"]))]),_:3})):f("",!0),a.someChildrenCanBeCalendared&&(this.allowedTabs.length===0||this.allowedTabs.includes("calendar"))?(s(),c(O,{key:1,name:"tab-calendar"},{default:n(()=>[o(u,{configsCollection:l.configsCollection,childRelations:a.childRelations,parentPrimaryKey:this.id},null,8,["configsCollection","childRelations","parentPrimaryKey"])]),_:1})):f("",!0),a.someChildrenCanBeMapped&&(this.allowedTabs.length===0||this.allowedTabs.includes("map"))?(s(),c(O,{key:2,name:"tab-map"},{default:n(()=>[v(" ... ")]),_:1})):f("",!0),(s(!0),m(g,null,_(a.filteredChildRelations,(i,y)=>(s(),c(O,{key:y,name:"tab-"+y},{default:n(()=>[o(b,{ref_for:!0,ref:`tab-${y}`,parentKeyValuePair:a.parentKeyValuePair(i),model:i.field.meta.field.related,canEdit:a.canEdit,forcedFilters:a.filters(i),onClickRow:(T,Q)=>{a.clickRow(T,Q,i)}},P({_:2},[e.$slots[i.field.name]?{name:"create",fn:n(()=>[M(e.$slots,i.field.name)]),key:"0"}:void 0]),1032,["parentKeyValuePair","model","canEdit","forcedFilters","onClickRow"])]),_:2},1032,["name"]))),128))]),_:3},8,["modelValue","class"])]),a.canEdit?(s(),m(g,{key:0},[a.superOptions.canEdit?(s(),m(g,{key:0},[o(E,{modelValue:r.editItemData.showModal,"onUpdate:modelValue":[t[4]||(t[4]=i=>r.editItemData.showModal=i),t[5]||(t[5]=i=>{r.formServerErrors={}})]},{default:n(()=>[r.editItemData.showModal?(s(),c(h,{key:0,titlePrefix:"Edit",modelValue:r.editItemData.data,"onUpdate:modelValue":t[2]||(t[2]=i=>r.editItemData.data=i),onSubmit:a.editItemSubmit,onCancel:t[3]||(t[3]=i=>{r.editItemData.showModal=!1,r.formServerErrors={}}),superOptions:a.superOptions,template:l.templateForm,style:{width:"700px","max-width":"calc(-32px + 100vw)"},formServerErrors:r.formServerErrors},null,8,["modelValue","onSubmit","superOptions","template","formServerErrors"])):f("",!0)]),_:1},8,["modelValue"]),o(E,{modelValue:r.deleteItemData.showModal,"onUpdate:modelValue":t[7]||(t[7]=i=>r.deleteItemData.showModal=i)},{default:n(()=>[o(Y,{style:{width:"500px","max-width":"calc(-32px + 100vw)"}},{default:n(()=>[o(k,{class:"q-pt-md q-pb-md q-pl-md q-pr-md"},{default:n(()=>[De]),_:1}),o(k,null,{default:n(()=>[Oe]),_:1}),o(Z,{align:"right"},{default:n(()=>[o(V,{onClick:t[6]||(t[6]=i=>r.deleteItemData.showModal=!1),flat:""},{default:n(()=>[v("Cancel")]),_:1}),o(V,{onClick:a.deleteItemSubmit,color:"negative",flat:""},{default:n(()=>[v("Delete")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)):f("",!0)],64)):f("",!0)])}const Me=R(_e,[["render",Fe],["__file","SuperRecord.vue"]]);export{Me as S};
