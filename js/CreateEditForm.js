const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/FieldUsageTypes.js","js/vendor.js","css/vendor.css","js/index.js","css/index.css"])))=>i.map(i=>d[i]);
import{aK as c,e as o,c as n,x as s,z as i,aG as y,b2 as A,aA as F,aB as P,a7 as p,b3 as C,b4 as L,aD as H,aE as v,b5 as Z,E as u,L as R,aQ as X,r as g,X as T,K as S,aC as z,b6 as $,b7 as ee,aJ as le,b8 as te,aF as N,_ as I,O as U,T as O,I as x,aN as K,aa as q,ak as ae,al as re,b9 as de}from"./vendor.js";import{d as w,e as Q,f as B,D as oe,g as ie,R as G,h as me,a as se,Q as j,F as _}from"./FieldUsageTypes.js";import{_ as k}from"./index.js";const ne={name:"DateRangePicker",props:{hideLabel:{type:Boolean,default(){return!1}},modelValue:{type:String,default:null}},data(){return{showDialog:!1,showStartDatePicker:!1,showEndDatePicker:!1,showStartTimePicker:!1,showEndTimePicker:!1,startDate:null,endDate:null,startTime:null,endTime:null,selectedTimezone:"Africa/Johannesburg",duration:120}},computed:{formattedValue(){let a="";return this.formattedStartDate&&this.formattedStartTime&&this.formattedEndTime&&(this.startDate===this.endDate?a=`${this.formattedStartDate} 
${this.formattedStartTime} - ${this.formattedEndTime} (${this.selectedTimezone})`:a=`${this.formattedStartDate} ${this.formattedStartTime} -
${this.formattedEndDate} ${this.formattedEndTime} (${this.selectedTimezone})`),a},formattedStartDate(){return this.startDate?c.tz(this.startDate,this.selectedTimezone).format("dddd, MMMM D, YYYY"):""},formattedEndDate(){return this.endDate?c.tz(this.endDate,this.selectedTimezone).format("dddd, MMMM D, YYYY"):""},formattedStartTime(){return this.startTime?c.tz(this.startTime,"HH:mm:ss",this.selectedTimezone).format("h:mm A"):""},formattedEndTime(){return this.endTime?c.tz(this.endTime,"HH:mm:ss",this.selectedTimezone).format("h:mm A"):""},dateTimeRange(){return this.formattedStartDate&&this.formattedStartTime&&this.formattedEndTime?`${this.formattedStartDate} 
 ${this.formattedStartTime} - ${this.formattedEndTime} (Africa/Johannesburg)`:null},pgDateTimeRange(){const a=c(`${this.startDate} ${this.startTime}`).format("YYYY-MM-DD HH:mm:ssZZ"),t=c(`${this.endDate} ${this.endTime}`).format("YYYY-MM-DD HH:mm:ssZZ");return`"[${a},${t}]"`}},methods:{parseTstzrange(a){const t=a.match(/\[(.*?),(.*)\]/);if(t){const e=c.tz(t[1],this.selectedTimezone),f=c.tz(t[2],this.selectedTimezone);this.detectDuration(e.format("HH:mm:ss"),f.format("HH:mm:ss")),this.startDate=e.format("YYYY-MM-DD"),this.startTime=e.format("HH:mm:ss"),this.endDate=f.format("YYYY-MM-DD"),this.endTime=f.format("HH:mm:ss")}},setDefaultStartTime(){this.showStartDatePicker=!1;const a=c.tz(this.selectedTimezone);a.minutes(0).seconds(0).milliseconds(0).add(1,"hours"),this.startTime=a.format("HH:mm:ss"),this.endDate=this.startDate},getTimestampsForDatabase(){const a=c.tz(`${this.startDate} ${this.startTime}`,this.selectedTimezone).toISOString(),t=c.tz(`${this.endDate} ${this.endTime}`,this.selectedTimezone).toISOString();return`[${a}, ${t}]`},finalizeDateTimeRange(){const a=this.getTimestampsForDatabase();this.$emit("update:modelValue",a),this.showDialog=!1},manuallyChangedEndTime(a){this.detectDuration(this.startTime,a)},detectDuration(a,t){this.duration=c(t,"HH:mm:ss").diff(c(a,"HH:mm:ss"),"minutes")}},watch:{startTime(a){this.endTime=c(a,"HH:mm:ss").add(this.duration,"minutes").format("HH:mm:ss")}},mounted(){this.parseTstzrange(this.modelValue)}},ue=p("div",{class:"text-h6"},"Start",-1),ce=p("div",{class:"text-h6"},"End",-1);function fe(a,t,e,f,r,l){return o(),n(Z,null,{default:s(()=>[i(y,{label:"Select Date Range",readonly:"",onClick:t[0]||(t[0]=d=>r.showDialog=!0),modelValue:l.formattedValue,"onUpdate:modelValue":t[1]||(t[1]=d=>l.formattedValue=d),error:!1,"error-message":"",filled:""},{append:s(()=>[i(A,{name:"event"})]),_:1},8,["modelValue"]),i(F,{modelValue:r.showDialog,"onUpdate:modelValue":t[18]||(t[18]=d=>r.showDialog=d),"max-width":"500px"},{default:s(()=>[i(P,{class:"q-pa-md"},{default:s(()=>[p("div",null,[ue,i(y,{label:"Start Date",modelValue:l.formattedStartDate,"onUpdate:modelValue":t[2]||(t[2]=d=>l.formattedStartDate=d),error:!1,"error-message":"",readonly:"",onClick:t[3]||(t[3]=d=>r.showStartDatePicker=!0),filled:""},null,8,["modelValue"]),i(F,{modelValue:r.showStartDatePicker,"onUpdate:modelValue":t[5]||(t[5]=d=>r.showStartDatePicker=d),"max-width":"290px"},{default:s(()=>[i(C,{modelValue:r.startDate,"onUpdate:modelValue":[t[4]||(t[4]=d=>r.startDate=d),l.setDefaultStartTime],error:!1,"error-message":""},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["modelValue"]),i(y,{label:"Start Time",modelValue:l.formattedStartTime,"onUpdate:modelValue":t[6]||(t[6]=d=>l.formattedStartTime=d),error:!1,"error-message":"",readonly:"",onClick:t[7]||(t[7]=d=>r.showStartTimePicker=!0),filled:""},null,8,["modelValue"]),i(F,{modelValue:r.showStartTimePicker,"onUpdate:modelValue":t[9]||(t[9]=d=>r.showStartTimePicker=d),"max-width":"290px"},{default:s(()=>[i(L,{modelValue:r.startTime,"onUpdate:modelValue":t[8]||(t[8]=d=>r.startTime=d)},null,8,["modelValue"])]),_:1},8,["modelValue"])]),p("div",null,[ce,i(y,{label:"End Date",modelValue:l.formattedEndDate,"onUpdate:modelValue":t[10]||(t[10]=d=>l.formattedEndDate=d),error:!1,"error-message":"",readonly:"",onClick:t[11]||(t[11]=d=>r.showEndDatePicker=!0),filled:""},null,8,["modelValue"]),i(F,{modelValue:r.showEndDatePicker,"onUpdate:modelValue":t[13]||(t[13]=d=>r.showEndDatePicker=d),"max-width":"290px"},{default:s(()=>[i(C,{modelValue:r.endDate,"onUpdate:modelValue":t[12]||(t[12]=d=>r.endDate=d)},null,8,["modelValue"])]),_:1},8,["modelValue"]),i(y,{label:"End Time",modelValue:l.formattedEndTime,"onUpdate:modelValue":t[14]||(t[14]=d=>l.formattedEndTime=d),error:!1,"error-message":"",readonly:"",onClick:t[15]||(t[15]=d=>r.showEndTimePicker=!0),filled:""},null,8,["modelValue"]),i(F,{modelValue:r.showEndTimePicker,"onUpdate:modelValue":t[17]||(t[17]=d=>r.showEndTimePicker=d),"max-width":"290px"},{default:s(()=>[i(L,{modelValue:r.endTime,"onUpdate:modelValue":[t[16]||(t[16]=d=>r.endTime=d),l.manuallyChangedEndTime]},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["modelValue"])]),i(H,{align:"right"},{default:s(()=>[i(v,{flat:"",label:"OK",color:"primary",onClick:l.finalizeDateTimeRange},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const W=k(ne,[["render",fe],["__file","DateAndTimeRangePicker.vue"]]),he={name:"DateAndTimePicker",props:{hideLabel:{type:Boolean,default:!1},modelValue:{type:String,default:null},label:{type:String,default:""},disabled:{type:Boolean,default:!1},useTimezone:{type:Boolean,default:!1}},data(){return{showDialog:!1,showDatePicker:!1,showTimePicker:!1,selectedDate:null,selectedTime:null,selectedTimezone:"Africa/Johannesburg"}},computed:{formattedValue(){return this.formattedDate&&this.formattedTime?`${this.formattedDate} ${this.formattedTime}${this.useTimezone?` (${this.selectedTimezone})`:""}`:""},formattedDate(){return this.selectedDate?this.useTimezone?c.tz(this.selectedDate,this.selectedTimezone).format("dddd, MMMM D, YYYY"):c(this.selectedDate).format("dddd, MMMM D, YYYY"):""},formattedTime(){return this.selectedTime?this.useTimezone?c.tz(this.selectedTime,"HH:mm:ss",this.selectedTimezone).format("h:mm A"):c(this.selectedTime,"HH:mm:ss").format("h:mm A"):""}},methods:{click(){this.disabled||(this.showDialog=!0)},setDefaultStartTime(){const a=this.useTimezone?c.tz(this.selectedTimezone):c();a.minutes(0).seconds(0).milliseconds(0).add(1,"hours"),this.selectedTime=a.format("HH:mm:ss")},parseTimestamptz(a){if(a){const t=this.useTimezone?c.tz(a,this.selectedTimezone):c(a);this.selectedDate=t.format("YYYY-MM-DD"),this.selectedTime=t.format("HH:mm:ss")}},getTimestampForDatabase(){return this.useTimezone?c.tz(`${this.selectedDate} ${this.selectedTime}`,this.selectedTimezone).toISOString():c(`${this.selectedDate} ${this.selectedTime}`).format("YYYY-MM-DDTHH:mm:ss.SSS")},finalizeDateTime(){const a=this.getTimestampForDatabase();this.$emit("update:modelValue",a),this.showDialog=!1}},watch:{modelValue:{immediate:!0,handler(a){this.parseTimestamptz(a)}}}},pe=p("div",{class:"q-mb-md"},"Select Date & Time",-1),Ve={class:"q-pa-md text-right"},ye={class:"q-pa-md text-right"};function ge(a,t,e,f,r,l){return o(),u("div",null,[i(y,{label:"Select Date Range",readonly:"",onClick:l.click,modelValue:l.formattedValue,"onUpdate:modelValue":t[0]||(t[0]=d=>l.formattedValue=d),error:!1,"error-message":"",dense:"",filled:"",disable:e.disabled},{append:s(()=>[i(A,{name:"calendar_today",onClick:l.click},null,8,["onClick"])]),_:1},8,["onClick","modelValue","disable"]),i(F,{modelValue:r.showDialog,"onUpdate:modelValue":t[11]||(t[11]=d=>r.showDialog=d),"max-width":"500px"},{default:s(()=>[i(P,{class:"q-pa-md"},{default:s(()=>[pe,i(y,{label:"Date",modelValue:l.formattedDate,"onUpdate:modelValue":t[1]||(t[1]=d=>l.formattedDate=d),error:!1,"error-message":"",readonly:"",onClick:t[2]||(t[2]=d=>r.showDatePicker=!0),dense:"",filled:""},null,8,["modelValue"]),i(F,{modelValue:r.showDatePicker,"onUpdate:modelValue":t[5]||(t[5]=d=>r.showDatePicker=d),"max-width":"290px"},{default:s(()=>[i(P,null,{default:s(()=>[i(C,{modelValue:r.selectedDate,"onUpdate:modelValue":[t[3]||(t[3]=d=>r.selectedDate=d),l.setDefaultStartTime]},null,8,["modelValue","onUpdate:modelValue"]),p("div",Ve,[i(v,{color:"primary",onClick:t[4]||(t[4]=d=>r.showDatePicker=!1)},{default:s(()=>[R("OK")]),_:1})])]),_:1})]),_:1},8,["modelValue"]),i(y,{label:"Time",modelValue:l.formattedTime,"onUpdate:modelValue":t[6]||(t[6]=d=>l.formattedTime=d),error:!1,"error-message":"",readonly:"",onClick:t[7]||(t[7]=d=>r.showTimePicker=!0),dense:"",filled:""},null,8,["modelValue"]),i(F,{modelValue:r.showTimePicker,"onUpdate:modelValue":t[10]||(t[10]=d=>r.showTimePicker=d),"max-width":"290px"},{default:s(()=>[i(P,null,{default:s(()=>[i(L,{modelValue:r.selectedTime,"onUpdate:modelValue":t[8]||(t[8]=d=>r.selectedTime=d)},null,8,["modelValue"]),p("div",ye,[i(v,{color:"primary",onClick:t[9]||(t[9]=d=>r.showTimePicker=!1)},{default:s(()=>[R("OK")]),_:1})])]),_:1})]),_:1},8,["modelValue"]),i(H,null,{default:s(()=>[i(X),i(v,{color:"primary",onClick:l.finalizeDateTime},{default:s(()=>[R("OK")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const Te=k(he,[["render",ge],["__file","DateAndTimePicker.vue"]]),Ee=N(()=>I(()=>import("./FieldUsageTypes.js").then(a=>a.i),__vite__mapDeps([0,1,2,3,4]))),be={name:"DatapointForEditInner",components:{SuperSelect:w,SearchGooglePlace:Q,DateAndTimePicker:Te,DateAndTimeRangePicker:W,RelationComponent:B,SuperTable:Ee},props:{disabled:{type:Boolean,default:!1},item:{type:Object,default:()=>({})},itemErrors:{type:Object,default:()=>({})},formServerErrors:{type:Object,default:()=>({})},hideLabel:{type:Boolean,default(){return!1}},modelValue:{type:[Object,String,Number,Boolean],default(){return null}},field:{type:Object,default(){return{}}},superOptions:{type:Object,default(){return{headers:[],modelFields:[],displayMapField:!1,model:{},canEdit:!1,currentParentRecord:{}}}}},data(){return{loading:!1}},computed:{itemPVal(){return this.item[this.superOptions.model.primaryKey]},compServerError(){let a=null;return this.formServerErrors&&this.formServerErrors.errors&&this.formServerErrors.errors[this.field.name]&&(a=this.formServerErrors.errors[this.field.name]),a},compError(){let a=null;return this.itemErrors&&this.itemErrors&&this.itemErrors[this.field.name]&&(a=`${this.field.label} is required.`),a},compLabel(){},compPlaceholder(){return this.field.label}},methods:{getForcedFilters(a){return typeof a.fieldExtras.linkablesRule=="function"?a.fieldExtras.linkablesRule():{}},handleFileUpload(a){a&&this.$emit("update:modelValue",a)},updateModelValue(a){this.$emit("update:modelValue",a)},updateForeignKey(a){this.$emit("update:modelValue",a)},updateStartTime(a){this.$emit("update:modelValue",a),this.$emit("updateSetDefaultEndTime",a)}},mounted(){}},De={key:0,class:"q-mb-md"},Fe=["src"];function Se(a,t,e,f,r,l){var M;const d=g("SuperTable"),m=g("SuperSelect"),h=g("RelationComponent"),V=g("DateAndTimeRangePicker"),E=g("DateAndTimePicker"),D=g("SearchGooglePlace");return o(),u("div",null,[e.field.dataType==="uid"?(o(),u(T,{key:0},[],64)):e.field.usageType.startsWith("rel")?(o(),u(T,{key:1},[e.field.usageType.startsWith("relLookup")?(o(),u(T,{key:0},[],64)):e.field.usageType.startsWith("relForeignKeyNormal")?(o(),n(d,{key:1,disabled:e.disabled,hideLabel:e.hideLabel,isForSelectingRelation:!0,canEdit:!1,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue,model:e.field.meta.field.parent,rules:[()=>!0],modelField:e.field,fetchFlags:{sort:e.field.meta.field.parent.titleKey},forcedFilters:l.getForcedFilters(e.field),onSuperTableMounted:t[0]||(t[0]=b=>a.$emit("superTableMounted")),errorMessage:l.compError},null,8,["disabled","hideLabel","modelValue","onUpdate:modelValue","model","modelField","fetchFlags","forcedFilters","errorMessage"])):e.field.usageType.startsWith("relForeignKeyMapExtraRel")?(o(),n(d,{key:2,hideLabel:e.hideLabel,isForSelectingRelation:!0,canEdit:!1,modelValue:e.modelValue,"onUpdate:modelValue":t[1]||(t[1]=b=>{l.updateModelValue(b),l.updateForeignKey(b)}),model:e.field.meta.field.parent,rules:[()=>!0],modelField:e.field,fetchFlags:{sort:e.field.meta.field.parent.titleKey},forcedFilters:l.getForcedFilters(e.field),onSuperTableMounted:t[2]||(t[2]=b=>a.$emit("superTableMounted")),errorMessage:l.compError,disabled:""},null,8,["hideLabel","modelValue","model","modelField","fetchFlags","forcedFilters","errorMessage"])):e.field.usageType=="relForeignKeyOwnerAppliedToProviderType"?(o(),n(m,{key:3,hideLabel:e.hideLabel,modelField:e.field,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue,model:e.field.meta.field.parent,readonly:"",variant:"filled",density:"default"},null,8,["hideLabel","modelField","modelValue","onUpdate:modelValue","model"])):e.field.usageType!=="relChildrenNormal"?(o(),n(h,{key:4,hideLabel:e.hideLabel,configs:e.field,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue},null,8,["hideLabel","configs","modelValue","onUpdate:modelValue"])):S("",!0)],64)):e.field.usageType=="timeRangeType"?(o(),n(V,{key:2,label:l.compLabel,placeholder:l.compPlaceholder,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue,rules:e.field.meta.rules,error:!!l.compError,"error-message":l.compError},null,8,["label","placeholder","modelValue","onUpdate:modelValue","rules","error","error-message"])):e.field.usageType=="timeRangeStart"?(o(),n(E,{key:3,label:l.compLabel,placeholder:l.compPlaceholder,modelValue:e.modelValue,"onUpdate:modelValue":l.updateStartTime,rules:e.field.meta.rules,error:!!l.compError,"error-message":l.compError},null,8,["label","placeholder","modelValue","onUpdate:modelValue","rules","error","error-message"])):e.field.usageType=="timeRangeEnd"?(o(),n(E,{key:4,label:l.compLabel,placeholder:l.compPlaceholder,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue,rules:e.field.meta.rules,error:!!l.compError,"error-message":l.compError},null,8,["label","placeholder","modelValue","onUpdate:modelValue","rules","error","error-message"])):e.field.usageType=="timestampType"?(o(),n(y,{key:5,label:l.compLabel,placeholder:l.compPlaceholder,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue,rules:e.field.meta.rules,error:!!l.compError,"error-message":l.compError,type:"datetime-local",filled:"",dense:""},null,8,["label","placeholder","modelValue","onUpdate:modelValue","rules","error","error-message"])):e.field.usageType=="dateType"?(o(),n(y,{key:6,label:l.compLabel,placeholder:l.compPlaceholder,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue,rules:e.field.meta.rules,error:!!l.compError,"error-message":l.compError,type:"date",filled:"",dense:""},null,8,["label","placeholder","modelValue","onUpdate:modelValue","rules","error","error-message"])):e.field.usageType.startsWith("fileImageType")?(o(),u(T,{key:7},[l.itemPVal?(o(),u("div",De,[i(P,{style:{width:"unset","max-width":"unset"},flat:"",class:"bg-grey-2"},{default:s(()=>[i(z,{class:"q-pa-sm",style:{"text-align":"center"}},{default:s(()=>[typeof e.modelValue=="string"&&e.modelValue.length?(o(),u("img",{key:0,src:`${e.modelValue}`,alt:"File not found.",style:{"max-width":"100%","max-height":"200px"}},null,8,Fe)):(o(),u(T,{key:1},[R(" Images can only be set on create. ")],64))]),_:1})]),_:1})])):(o(),n($,{key:1,modelValue:e.modelValue,"onUpdate:modelValue":l.handleFileUpload,label:l.compLabel,accept:".pdf,.jpg,.jpeg,.png",error:!!l.compError,"error-message":l.compError,class:"q-mb-md",filled:"",dense:""},{prepend:s(()=>[i(A,{name:"attach_file"})]),_:1},8,["modelValue","onUpdate:modelValue","label","error","error-message"]))],64)):e.field.usageType.startsWith("htmlField")?(o(),n(ee,{key:8,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue,toolbar:[["bold","italic","underline","strike"],["quote","unordered","ordered","outdent","indent"],["link","image","hr"],["undo","redo"]],label:l.compLabel,error:!!l.compError,"error-message":l.compError,dense:"",placeholder:l.compPlaceholder,rules:e.field.meta.rules,filled:""},null,8,["modelValue","onUpdate:modelValue","label","error","error-message","placeholder","rules"])):e.field.usageType.startsWith("staticLookup")&&((M=e.field.fieldExtras.usageTypeExtras)!=null&&M.options)?(o(),n(le,{key:9,label:l.compLabel,placeholder:l.compPlaceholder,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue,"option-label":"label","option-value":"value",emitValue:"",mapOptions:"",rules:e.field.meta.rules,error:!!l.compError,"error-message":l.compError,options:e.field.fieldExtras.usageTypeExtras.options,filled:"",dense:""},null,8,["label","placeholder","modelValue","onUpdate:modelValue","rules","error","error-message","options"])):e.field.usageType=="readOnlyTimestampType"?(o(),n(E,{key:10,label:l.compLabel,placeholder:l.compPlaceholder,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue,rules:e.field.meta.rules,error:!!l.compError,"error-message":l.compError,disabled:""},null,8,["label","placeholder","modelValue","onUpdate:modelValue","rules","error","error-message"])):e.field.usageType==="location_address_place_name"?(o(),n(D,{key:11,hideLabel:e.hideLabel,configs:e.field,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue,onPlaceSelected:t[3]||(t[3]=b=>{a.$emit("placeSelected",b)})},null,8,["hideLabel","configs","modelValue","onUpdate:modelValue"])):e.field.usageType.startsWith("mapExtra")?(o(),n(y,{key:12,label:l.compLabel,placeholder:l.compPlaceholder,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue,rules:e.field.meta.rules,error:!!l.compError,"error-message":l.compError,filled:"",dense:""},null,8,["label","placeholder","modelValue","onUpdate:modelValue","rules","error","error-message"])):e.field.usageType=="normal"?(o(),u(T,{key:13},[e.field.dataType==="string"?(o(),n(y,{key:0,label:l.compLabel,placeholder:l.compPlaceholder,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue,rules:e.field.meta.rules,error:!!l.compError,"error-message":l.compError,filled:"",dense:""},null,8,["label","placeholder","modelValue","onUpdate:modelValue","rules","error","error-message"])):e.field.dataType==="boolean"?(o(),n(te,{key:1,label:l.compLabel,placeholder:l.compPlaceholder,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue,rules:e.field.meta.rules,error:!!l.compError,"error-message":l.compError},null,8,["label","placeholder","modelValue","onUpdate:modelValue","rules","error","error-message"])):e.field.dataType==="number"?(o(),n(y,{key:2,label:l.compLabel,placeholder:l.compPlaceholder,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue,rules:e.field.meta.rules,error:!!l.compError,"error-message":l.compError,type:"number",filled:"",dense:""},null,8,["label","placeholder","modelValue","onUpdate:modelValue","rules","error","error-message"])):e.field.dataType==="attr"?(o(),n(y,{key:3,label:l.compLabel,placeholder:l.compPlaceholder,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue,rules:e.field.meta.rules,error:!!l.compError,"error-message":l.compError,filled:"",dense:""},null,8,["label","placeholder","modelValue","onUpdate:modelValue","rules","error","error-message"])):S("",!0)],64)):(o(),n(y,{key:14,label:l.compLabel,placeholder:l.compPlaceholder,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue,rules:e.field.meta.rules,error:!!l.compError,"error-message":l.compError,filled:"",dense:""},null,8,["label","placeholder","modelValue","onUpdate:modelValue","rules","error","error-message"]))])}const Y=k(be,[["render",Se],["__file","DatapointForEditInner.vue"]]),ke={name:"DatapointForEdit",components:{DatapointForDisplayInner:oe,DatapointForEditInner:Y},props:{itemErrors:{type:Object,default:()=>({})},formServerErrors:{type:Object,default:()=>({})},compField:{type:Object,default(){return{}}},dataPoint:{type:Object,default(){return{}}},modelValue:{type:[Object,String,Number,Boolean],default(){return null}},superOptions:{type:Object,default(){return{headers:[],modelFields:[],displayMapField:!1,model:{},canEdit:!1,currentParentRecord:{}}}}},data(){return{}},computed:{label(){return typeof this.dataPoint.label!="undefined"?this.dataPoint.label:this.dataPoint.type==="function"?"":this.compField?this.compField.label:""}},methods:{updateModelValue(a,t){this.itemData[t]=a,this.$emit("update:modelValue",this.itemData)}},mounted(){this.itemData=this.modelValue}},Me={key:0,class:""},Pe={class:"row"},ve={class:"q-pr-sm col-6 col-md-6 col-sm-6 col-xs-6"},Ue={class:"text-bold",style:{"line-height":"3em"}},Oe={class:"col-6 col-md-6 col-sm-6 col-xs-6"},xe=["innerHTML"],_e=["innerHTML"];function Re(a,t,e,f,r,l){const d=g("DatapointForEditInner");return o(),u("div",null,[e.dataPoint.xOrientation?(o(),u("div",Me,[p("div",Pe,[p("div",ve,[p("div",Ue,U(l.label)+": ",1)]),p("div",Oe,[(o(),n(K(e.dataPoint.tag?e.dataPoint.tag:"div"),{class:O(e.dataPoint.class?e.dataPoint.class:""),style:x(e.dataPoint.style?e.dataPoint.style:"")},{default:s(()=>[e.dataPoint.type==="function"?(o(),u("div",{key:0,innerHTML:e.dataPoint.function(e.modelValue)},null,8,xe)):(o(),u(T,{key:1},[e.compField?(o(),n(d,{key:0,item:e.modelValue,modelValue:e.modelValue[e.compField.name],"onUpdate:modelValue":t[0]||(t[0]=m=>{l.updateModelValue(m,e.compField.name)}),superOptions:e.superOptions,onUpdateSetDefaultEndTime:t[1]||(t[1]=m=>{a.$emit("updateSetDefaultEndTime",m)}),field:e.compField,hideLabel:"",formServerErrors:e.formServerErrors,onPlaceSelected:t[2]||(t[2]=m=>{a.$emit("placeSelected",m)})},null,8,["item","modelValue","superOptions","field","formServerErrors"])):S("",!0)],64))]),_:1},8,["class","style"]))])])])):(o(),u(T,{key:1},[e.dataPoint.hideLabel?S("",!0):(o(),u("div",{key:0,class:"text-bold",style:x(`visibility: ${l.label.length?"visible":"hidden"}`)},U(l.label)+": ",5)),(o(),n(K(e.dataPoint.tag?e.dataPoint.tag:"div"),{class:O(e.dataPoint.class?e.dataPoint.class:""),style:x(e.dataPoint.style?e.dataPoint.style:"")},{default:s(()=>[e.dataPoint.type==="function"?(o(),u("div",{key:0,innerHTML:e.dataPoint.function(e.modelValue)},null,8,_e)):(o(),u(T,{key:1},[e.compField?(o(),n(d,{key:0,item:e.modelValue,modelValue:e.modelValue[e.compField.name],"onUpdate:modelValue":t[3]||(t[3]=m=>{l.updateModelValue(m,e.compField.name)}),superOptions:e.superOptions,onUpdateSetDefaultEndTime:t[4]||(t[4]=m=>{a.$emit("updateSetDefaultEndTime",m)}),field:e.compField,hideLabel:"",formServerErrors:e.formServerErrors,itemErrors:e.itemErrors,onPlaceSelected:t[5]||(t[5]=m=>{a.$emit("placeSelected",m)})},null,8,["item","modelValue","superOptions","field","formServerErrors","itemErrors"])):S("",!0)],64))]),_:1},8,["class","style"]))],64))])}const we=k(ke,[["render",Re],["__file","DatapointForEdit.vue"]]),Ce={name:"RecordFieldsForEditCustom",components:{DatapointForEdit:we,DatapointForDisplay:ie,RecordFieldsForDisplayCustom:G,SuperSelect:w,DatapointForEditInner:Y},props:{formServerErrors:{type:Object,default:()=>({})},itemErrors:{type:Object,default:()=>({})},template:{type:Object,default(){return{}}},modelValue:{type:Object,default:()=>({})},superOptions:{type:Object,default(){return{headers:[],modelFields:[],displayMapField:!1,model:{},canEdit:!1,currentParentRecord:{}}}}},data(){return{loading:!1}},computed:{compField(){var a;return((a=this.template.dataPoint)==null?void 0:a.type)==="function"?{label:this.template.dataPoint.label}:this.superOptions.modelFields.find(e=>e.field==this.template.dataPoint.field)}},mounted(){},methods:{colClasses(a=12){a=+a;const t={lg:1,md:1.5,sm:2,xs:4};function e(m){return[1,2,3,4,6,12].reduce((V,E)=>Math.abs(E-m)<Math.abs(V-m)?E:V)}const f=e(a*t.lg),r=e(a*t.md),l=e(a*t.sm),d=e(a*t.xs);return`col-${f} col-lg-${f} col-md-${r} col-sm-${l} col-xs-${d}`},updateModelValue(a){this.$emit("update:modelValue",a)}},watch:{}},Le={style:{"padding-top":"0.03px"}},ze={key:1,class:"col-12"};function Ae(a,t,e,f,r,l){var h,V,E;const d=g("RecordFieldsForEditCustom",!0),m=g("DatapointForEdit");return o(),u("div",{class:O(l.colClasses(e.template.width?e.template.width:12))},[p("div",Le,[p("div",{class:O(["row",`${e.template.unsetGutters?"":"q-col-gutter-xs"} ${(h=e.template.class)!=null&&h.length?e.template.class:""} `]),style:x(`${(V=e.template.style)!=null&&V.length?e.template.style:""}`)},[(E=e.template.cols)!=null&&E.length?(o(!0),u(T,{key:0},q(e.template.cols,(D,M)=>(o(),n(d,{key:M,modelValue:e.modelValue,"onUpdate:modelValue":l.updateModelValue,superOptions:e.superOptions,onUpdateSetDefaultEndTime:t[0]||(t[0]=b=>{a.$emit("updateSetDefaultEndTime",b)}),template:D,formServerErrors:e.formServerErrors,itemErrors:e.itemErrors,onPlaceSelected:t[1]||(t[1]=b=>{a.$emit("placeSelected",b)})},null,8,["modelValue","onUpdate:modelValue","superOptions","template","formServerErrors","itemErrors"]))),128)):e.template.dataPoint&&l.compField.meta&&!l.compField.meta.hideField?(o(),u("div",ze,[p("div",{class:O(e.template.dataPoint.noMargin?"":"q-mb-sm")},[i(m,{modelValue:e.modelValue,compField:l.compField,"onUpdate:modelValue":l.updateModelValue,superOptions:e.superOptions,onUpdateSetDefaultEndTime:t[2]||(t[2]=D=>{a.$emit("updateSetDefaultEndTime",D)}),dataPoint:e.template.dataPoint,formServerErrors:e.formServerErrors,itemErrors:e.itemErrors,onPlaceSelected:t[3]||(t[3]=D=>{a.$emit("placeSelected",D)})},null,8,["modelValue","compField","onUpdate:modelValue","superOptions","dataPoint","formServerErrors","itemErrors"])],2)])):S("",!0)],6)])],2)}const J=k(Ce,[["render",Ae],["__file","RecordFieldsForEditCustom.vue"]]),He={name:"RecordFieldsForEditGeneric",components:{RecordFieldsForEditCustom:J,SuperSelect:w,DatapointForEditInner:Y},props:{itemErrors:{type:Object,default:()=>({})},formServerErrors:{type:Object,default:()=>({})},modelValue:{type:Object,default:()=>({})},superOptions:{type:Object,default(){return{headers:[],modelFields:[],displayMapField:!1,model:{},canEdit:!1,currentParentRecord:{}}}}},data(){return{rendered:!1,itemData:this.modelValue,loading:!1}},mounted(){this.itemData=this.modelValue,this.autoFillAll()},methods:{updateModelValue(a,t){this.itemData[t]=a,this.$emit("update:modelValue",this.itemData)},autoFillAll(){for(const a of this.superOptions.modelFields)typeof a.fieldExtras.autoFill=="function"&&(this.itemData[a.name]=a.fieldExtras.autoFill(this.itemData));this.$emit("update:modelValue",this.itemData)}},watch:{itemData:{handler(){this.autoFillAll()},deep:!0}}},Ye={key:0,class:"q-mb-sm"};function Ke(a,t,e,f,r,l){const d=g("DatapointForEditInner");return o(),u("div",null,[(o(!0),u(T,null,q(e.superOptions.modelFields,m=>(o(),u(T,{key:m.name},[e.superOptions.model.primaryKey!==m.name&&!m.meta.hideField&&!["relLookupNormal","relChildrenNormal"].includes(m.usageType)&&!m.usageType.startsWith("relLookupMap")&&!m.usageType.startsWith("relForeignKeyMap")&&!m.usageType.startsWith("mapExtraGeo")&&!m.usageType.startsWith("mapExtraPlace")?ae((o(),u("div",Ye,[r.rendered&&!m.usageType.startsWith("relLookupMapExtraRel")?(o(),u("div",{key:0,class:"text-subtitle2",style:x(`visibility: ${m.label.length?"visible":"hidden"}`)},U(m.label)+": ",5)):S("",!0),i(d,{onSuperTableMounted:t[0]||(t[0]=h=>r.rendered=!0),item:r.itemData,modelValue:r.itemData[m.name],"onUpdate:modelValue":h=>{l.updateModelValue(h,m.name)},superOptions:e.superOptions,onUpdateSetDefaultEndTime:t[1]||(t[1]=h=>{a.$emit("updateSetDefaultEndTime",h)}),field:m,formServerErrors:e.formServerErrors,itemErrors:e.itemErrors,hideLabel:"",onPlaceSelected:t[2]||(t[2]=h=>{a.$emit("placeSelected",h)})},null,8,["item","modelValue","onUpdate:modelValue","superOptions","field","formServerErrors","itemErrors"])],512)),[[re,typeof m.fieldExtras.autoFill!="function"]]):S("",!0)],64))),128))])}const je=k(He,[["render",Ke],["__file","RecordFieldsForEditGeneric.vue"]]),Ne=N(()=>I(()=>import("./FieldUsageTypes.js").then(a=>a.i),__vite__mapDeps([0,1,2,3,4]))),Ie={name:"CreateEditForm",components:{CreateButton:me,RecordFieldsForEditCustom:J,RecordFieldsForDisplayCustom:G,RecordFieldsForDisplayGeneric:se,RecordFieldsForEditGeneric:je,SuperSelect:w,SearchGooglePlace:Q,DateAndTimeRangePicker:W,RelationComponent:B,SuperTable:Ne},props:{template:{type:Object,default(){return{}}},submitting:{type:Boolean,default(){return!1}},titlePrefix:{type:String,default:()=>""},modelValue:{type:Object,default:()=>({})},formServerErrors:{type:Object,default:()=>({})},superOptions:{type:Object,default(){return{headers:[],modelFields:[],displayMapField:!1,model:{},canEdit:!1,currentParentRecord:{}}}}},data(){return{itemData:this.modelValue,loading:!1,itemErrors:{}}},computed:{placeFieldsWithFieldNames(){let a=[];if(this.superOptions.modelFields.find(e=>e.usageType=="location_address_place_name"))for(const e of j.mapPlaceFields()){const f=this.superOptions.modelFields.find(r=>r.usageType==e.flag);f&&a.push({...e,fieldNames:f.name,fieldMore:f})}return a}},methods:{async upsertAndGetEntityIds(a){let t=null;const e={relForeignKeyMapExtraRelCountry:this.superOptions.modelFields.find(l=>l.usageType=="relForeignKeyMapExtraRelCountry").meta.relatedModel,relForeignKeyMapExtraRelAdminArea1:this.superOptions.modelFields.find(l=>l.usageType=="relForeignKeyMapExtraRelAdminArea1").meta.relatedModel,relForeignKeyMapExtraRelAdminArea2:this.superOptions.modelFields.find(l=>l.usageType=="relForeignKeyMapExtraRelAdminArea2").meta.relatedModel,relForeignKeyMapExtraRelLocality:this.superOptions.modelFields.find(l=>l.usageType=="relForeignKeyMapExtraRelLocality").meta.relatedModel,relForeignKeyMapExtraRelSublocality:this.superOptions.modelFields.find(l=>l.usageType=="relForeignKeyMapExtraRelSublocality").meta.relatedModel};let f=[],r=[];for(const l of j.mapPlaceFields())if(l.googleType==="components"){let d;if(Array.isArray(l.googleName)){for(const h of l.googleName)if(d=a.address_components.find(V=>V.types.includes(h)),d)break}else d=a.address_components.find(h=>h.types.includes(l.googleName));let m="";if(d?m=d.long_name:l.flag==="relForeignKeyMapExtraRelSublocality"?m=f.relForeignKeyMapExtraRelLocality:l.flag==="relForeignKeyMapExtraRelAdminArea2"?m=f.relForeignKeyMapExtraRelAdminArea1:l.flag==="relForeignKeyMapExtraRelLocality"?m="Unknown":m=null,f[l.flag]=m,e[l.flag]){let h={name:m};l.flag!=="relForeignKeyMapExtraRelCountry"&&(h.parent_id=t);let V="";l.flag==="relForeignKeyMapExtraRelAdminArea1"?V=_.mapExtraRelCountry():l.flag==="relForeignKeyMapExtraRelAdminArea2"?V=_.mapExtraRelAdminArea1():l.flag==="relForeignKeyMapExtraRelLocality"?V=_.mapExtraRelAdminArea2():l.flag==="relForeignKeyMapExtraRelSublocality"&&(V=_.mapExtraRelLocality());const E=Object.keys(e[l.flag].fieldsMetadata).find(M=>e[l.flag].fieldsMetadata[M].usageType===V);h[E]=t,t=(await e[l.flag].Store({...h},[],{upsertCompareOn:"name",upsertCompareMode:"sluggify"},{})).response.data.data.id,r[l.flag]=t}}return r},async placeSelected(a){var e,f;this.loading=!0;const t=await this.upsertAndGetEntityIds(a);console.log(t);for(const r of this.placeFieldsWithFieldNames)r.googleType==="simple"?this.itemData[r.fieldNames]=a[r.googleName]:r.googleType==="mapGeoLoc"?(f=(e=a.geometry)==null?void 0:e.location)!=null&&f[r.googleName]&&(this.itemData[r.fieldNames]=a.geometry.location[r.googleName]()):r.googleType==="components"&&(this.itemData[r.fieldNames]=t[r.flag]);this.loading=!1},updateSetDefaultEndTime(a){const t=this.superOptions.modelFields.find(e=>e.usageType==="timeRangeEnd");this.itemData[t.name]=c(a).add(2,"hours").format("YYYY-MM-DDTHH:mm:ss.SSS")},cancel(){this.$emit("cancel")},updateModelValue(a){this.$emit("update:modelValue",a)},getRequiredFields(){return this.superOptions.modelFields.filter(a=>a.meta&&a.meta.required).map(a=>a.name)},validateField(a,t){t?delete this.itemErrors[a]:this.itemErrors[a]="Required"},validateForm(){return this.itemErrors={},this.getRequiredFields().forEach(t=>{this.validateField(t,this.modelValue[t])}),Object.keys(this.itemErrors).length===0},async editItemSubmit(){this.validateForm()&&this.$emit("submit")}},mounted(){}},qe={class:"text-h6"},Qe={key:0,style:{"padding-top":"0.03px"}},Be={class:"row q-col-gutter-xs"},Ge={style:{width:"100%"}},We={class:"text-right text-negative"},Je={class:"text-right"};function Ze(a,t,e,f,r,l){const d=g("RecordFieldsForEditCustom"),m=g("RecordFieldsForEditGeneric");return o(),n(P,{class:""},{default:s(()=>[i(z,null,{default:s(()=>{var h,V;return[p("div",qe,U(e.titlePrefix)+" "+U((h=e.superOptions.model)!=null&&h.entityHumanName?(V=e.superOptions.model)==null?void 0:V.entityHumanName:"Item"),1)]}),_:1}),i(z,null,{default:s(()=>[i(de,{ref:"editForm"},{default:s(()=>[e.template&&e.template.cols?(o(),u("div",Qe,[p("div",Be,[i(d,{modelValue:r.itemData,"onUpdate:modelValue":l.updateModelValue,superOptions:e.superOptions,onUpdateSetDefaultEndTime:l.updateSetDefaultEndTime,template:e.template,formServerErrors:e.formServerErrors,itemErrors:r.itemErrors,onPlaceSelected:l.placeSelected},null,8,["modelValue","onUpdate:modelValue","superOptions","onUpdateSetDefaultEndTime","template","formServerErrors","itemErrors","onPlaceSelected"])])])):(o(),n(m,{key:1,modelValue:r.itemData,"onUpdate:modelValue":l.updateModelValue,superOptions:e.superOptions,onUpdateSetDefaultEndTime:l.updateSetDefaultEndTime,formServerErrors:e.formServerErrors,itemErrors:r.itemErrors,onPlaceSelected:l.placeSelected},null,8,["modelValue","onUpdate:modelValue","superOptions","onUpdateSetDefaultEndTime","formServerErrors","itemErrors","onPlaceSelected"]))]),_:1},512)]),_:1}),i(H,null,{default:s(()=>[p("div",Ge,[p("div",We,U(Object.keys(r.itemErrors).length?`${Object.keys(r.itemErrors)[0]} is required${Object.keys(r.itemErrors).length>1?" (and "+(Object.keys(r.itemErrors).length-1)+" more error/s).":"."} `:""),1),p("div",Je,[i(v,{flat:"",label:"Cancel",onClick:l.cancel},null,8,["onClick"]),i(v,{flat:"",label:"Save",color:"primary",onClick:l.editItemSubmit,loading:r.loading||e.submitting},null,8,["onClick","loading"])])])]),_:1})]),_:1})}const ll=k(Ie,[["render",Ze],["__file","CreateEditForm.vue"]]);export{ll as default};
